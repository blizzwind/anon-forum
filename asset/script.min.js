function chkPath() {
  var url = location.href.split("/");
  if (url[3] == "" && url[4] == undefined) {
    document.getElementById("content").style.height = "calc(100% - 10rem)";
	document.getElementById("sap").style.display = "block";
	document.getElementById("up").style.bottom = "6.3125rem";
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
	  if (this.readyState == 4 && this.status == 200) {
	    document.getElementById("content").innerHTML = xhttp.responseText;
	  }
	};
	xhttp.open("GET", "/src/qIndex.php", true);
	xhttp.send();
  } else if (url[3] == "post" && Number.isInteger(Number(url[4])) && url[5] == undefined) {
    document.getElementById("content").style.height = "calc(100% - 10rem)";
	document.getElementById("sam").style.display = "block";
	document.getElementById("up").style.bottom = "6.3125rem";
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
	  if (this.readyState == 4 && this.status == 200) {
	    document.getElementById("content").innerHTML = xhttp.responseText;
	  }
	};
	xhttp.open("POST", "/src/qPost.php", true);
	xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	xhttp.send("id="+location.href.split("/")[4]);
  } else if (url[3].startsWith("search?q=")) {
	var xhttp = new XMLHttpRequest();
	xhttp.open("POST", "/src/qSrh.php", true);
	xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	xhttp.send("srh='"+location.href.slice(location.href.indexOf("search?q=")+9)+"'");
	xhttp.onreadystatechange = function() {
	  if (this.readyState == 4 && this.status == 200) {
	    document.getElementById("content").innerHTML = xhttp.responseText;
	  }
	};
  } else {
    document.getElementById("content").innerHTML = "<div id='err'><span class='icon-err'></span></div>";
  }
}
function flagPost(elm) {
  var xhttp = new XMLHttpRequest();
  xhttp.open("POST", "/src/flag.php", true);
  xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  xhttp.send("id="+elm.id.substring(5)+"&type='post'");
}
function flagMsg(elm) {
  var xhttp = new XMLHttpRequest();
  xhttp.open("POST", "/src/flag.php", true);
  xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  xhttp.send("id="+elm.id.substring(5)+"&type='msg'");
}
function sendPost() {
  if (document.getElementById("sap-text").value != "") {
    if (document.getElementById("sap-name").value == "") {
	  document.getElementById("sap-name").value = "Anonymous";
	}
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
	  if (this.readyState == 4 && this.status == 200) {
	    document.getElementById("sap-ava").value = "";
		document.getElementById("sap-name").value = "";
		document.getElementById("sap-text").value = "";
	  }
	};
	xhttp.open("POST", "/src/post.php", true);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send("ava='"+document.getElementById("sap-ava").value+"'&name='"+document.getElementById("sap-name").value+"'&text='"+document.getElementById("sap-text").value+"'");
  }
}
function sendMsg() {
  if (document.getElementById("sam-text").value != "") {
    if (document.getElementById("sam-name").value == "") {
	  document.getElementById("sam-name").value = "Anonymous";
	}
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
	  if (this.readyState == 4 && this.status == 200) {
	    document.getElementById("sam-ava").value = "";
		document.getElementById("sam-name").value = "";
		document.getElementById("sam-text").value = "";
	  }
	};
	xhttp.open("POST", "/src/msg.php", true);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send("ava='"+document.getElementById("sam-ava").value+"'&name='"+document.getElementById("sam-name").value+"'&text='"+document.getElementById("sam-text").value+"'&id="+location.href.split("/")[4]);
  }
}
function act(elm) {
  var xhttp = new XMLHttpRequest();
  xhttp.open("POST", "/src/act.php", true);
  xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  xhttp.send("id="+elm.id.substring(4));
  elm.innerHTML = "<span class='icon-act'></span>"+(Number(elm.innerText)+1);
}
function reAva(elm) {
  ava = document.createElement("a");
  ava.classList.add("ava");
  ava.innerHTML = "<span class='icon-user'></span>";
  elm.parentNode.replaceChild(ava, elm);
}
function share(elm) {
  navigator.clipboard.writeText("https://dizcourze.com/post/"+elm.id.substring(6));
}
function srh() {
  if (document.getElementById("srh").value != "") {
    location.href = "/search?q="+document.getElementById("srh").value;
  }
}
chkPath();
